<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>把blog部署到华为云nginx | Sirius' Blog</title>
<meta name=keywords content="blog,云服务器,nginx,web服务器"><meta name=description content="这篇文章记录了把本地的博客部署到华为云ubuntu的nginx"><meta name=author content="sirius1y"><link rel=canonical href=//localhost:1313/posts/notes/dev/%E5%8D%9A%E5%AE%A2nginx%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91/><link crossorigin=anonymous href=/assets/css/stylesheet.3551607c8eb1ef998f0b6c81d22f9f03dd2c3b8ecaf983e42c023e8d41e39f66.css integrity="sha256-NVFgfI6x75mPC2yB0i+fA90sO47K+YPkLAI+jUHjn2Y=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/images/icon.png><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/posts/notes/dev/%E5%8D%9A%E5%AE%A2nginx%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="把blog部署到华为云nginx"><meta property="og:description" content="这篇文章记录了把本地的博客部署到华为云ubuntu的nginx"><meta property="og:type" content="article"><meta property="og:url" content="//localhost:1313/posts/notes/dev/%E5%8D%9A%E5%AE%A2nginx%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91/"><meta property="og:image" content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-16T00:00:00+00:00"><meta property="og:site_name" content="Sirius' Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="把blog部署到华为云nginx"><meta name=twitter:description content="这篇文章记录了把本地的博客部署到华为云ubuntu的nginx"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"//localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"把blog部署到华为云nginx","item":"//localhost:1313/posts/notes/dev/%E5%8D%9A%E5%AE%A2nginx%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"把blog部署到华为云nginx","name":"把blog部署到华为云nginx","description":"这篇文章记录了把本地的博客部署到华为云ubuntu的nginx","keywords":["blog","云服务器","nginx","web服务器"],"articleBody":"起因 本来博客是一直使用github pages进行部署的，但是国内的github.io太慢了，并且刚好在年末促销买了一台一年的华为云服务器，就想试一试。\n在云服务器上安装nginx sudo apt-get install nginx nginx的常用命令 # 启动 Nginx 服务 sudo systemctl start nginx # 停止 Nginx 服务 sudo systemctl stop nginx # 重新启动 Nginx 服务（用于配置更改后使更改生效） sudo systemctl restart nginx # 重新加载 Nginx 配置文件（不中断服务） sudo systemctl reload nginx # 检查 Nginx 服务的状态 sudo systemctl status nginx # 测试配置文件的正确性（在实际重新加载或重启 Nginx 之前） sudo nginx -t # 显示 Nginx 的版本和配置选项 nginx -v # 设置 Nginx 开机自动启动 sudo systemctl enable nginx # 禁用 Nginx 开机自动启动 sudo systemctl disable nginx # 查看 Nginx 的错误日志（路径可能根据安装和配置有所不同） sudo tail -f /var/log/nginx/error.log # 查看 Nginx 的访问日志（路径可能根据安装和配置有所不同） sudo tail -f /var/log/nginx/access.log 把本地的public/下的文件复制到云服务器上 nginx默认的起始欢迎页面在/var/www/html/index.nginx-debian.html；\n而我们可以把博客的public文件夹放在/var/www/sites/下面，即博客的index在/var/www/sites/public/index.html\n# 本地执行 scp -r public username@hostname:~/mysites ssh username@hostname # 云服务器上 sudo cp -r mysites /var/www/mysites 配置nginx nginx的配置文件在/etc/nginx/site-available/，在这个文件夹下有一个默认的配置文件default。\n把default复制一份，再进行修改。\n主要修改就是sever_name部分，改为自己的域名；同时把root的路径指向包含博客index.html的目录。\nserver { listen 80 default_server; listen [::]:80 default_server; # SSL configuration # # listen 443 ssl default_server; # listen [::]:443 ssl default_server; # # Note: You should disable gzip for SSL traffic. # See: https://bugs.debian.org/773332 # # Read up on ssl_ciphers to ensure a secure configuration. # See: https://bugs.debian.org/765782 # # Self signed certs generated by the ssl-cert package # Don't use them in a production server! # # include snippets/snakeoil.conf; root /var/www/mysites/public; # Add index.php to the list if you are using PHP index index.html index.htm index.nginx-debian.html; server_name sirius1y.me; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. try_files $uri $uri/ =404; } # pass PHP scripts to FastCGI server # #location ~ \\.php$ { # include snippets/fastcgi-php.conf; # # # With php-fpm (or other unix sockets): # fastcgi_pass unix:/run/php/php7.4-fpm.sock; # # With php-cgi (or other tcp sockets): # fastcgi_pass 127.0.0.1:9000; #} # deny access to .htaccess files, if Apache's document root # concurs with nginx's one # #location ~ /\\.ht { # deny all; #} } 然后使用IP和域名进行访问就OK了。记得启动nginx服务器就是了：sudo systemctl start nginx\n实现自动部署 我想要实现在本地写完笔记之后先把源码上传到dev-hugo上，并且部署到master分支上，同时把public部署到nginx上。\n原来的脚本，实现了前两个功能，并且能够自动添加更改的文件的提交信息。\n# 定义FILES变量 FILES=$(cd /home/yoho/projects/blogs/hugo/content/posts/Notes \u0026\u0026 git status --porcelain | awk '{print $2}' | paste -sd, -) # 同步笔记到sirius2alpha/Notes echo ------------------------start---同步笔记到sirius2alpha/Notes------------------------ cd /home/yoho/projects/blogs/hugo/content/posts/Notes git add . git commit -m \"update: $FILES\" git pull git push echo ------------------------end---同步笔记到sirius2alpha/Notes------------------------ # sync dev-hugo branch echo ------------------------start---sync dev-hugo branch------------------------------ cd /home/yoho/projects/blogs/hugo git add . git commit -m \"update: $FILES\" git pull git push echo ------------------------end---sync dev-hugo branch------------------------------ # build cd ~/projects/blogs/hugo hugo # master branch only push echo ------------------------start---master branch------------------------------------- cd ~/projects/blogs/hugo/public git add . git commit -m \"feat: $FILES\" git push origin master echo ------------------------end---master branch------------------------------------- # 部署到 Nginx 服务器，和/etc/nginx/sites-available/mysite中的root一致 NGINX_SERVER_PATH=\"/var/www/mysites\" # 使用 rsync 同步 public 目录到 Nginx 服务器的相应目录 rsync -av --delete -e \"ssh -p 22\" ~/projects/blogs/hugo/public/ root@1.94.126.139:$NGINX_SERVER_PATH # 重启 Nginx 服务 ssh root@1.94.126.139 \"sudo systemctl reload nginx\" rsync -av --delete ~/projects/blogs/hugo/public/ $NGINX_SERVER_PATH 命令的意思是：\nrsync: 这是一个非常强大的文件和目录同步工具，广泛用于备份和镜像目的。 -av: 这是两个选项的组合。 -a 或 --archive 表示启用归档模式，这会保留符号链接、设备、属性、权限、所有权等信息，并且会递归复制目录。 -v 或 --verbose 表示详细模式，会显示关于正在执行的同步操作的更多信息。 --delete: 这个选项会在同步过程中删除目标目录中存在而源目录中不存在的文件。这确保目标目录是源目录的精确镜像，包括移除已经在源目录中被删除的文件。 ~/projects/blogs/hugo/public/: 这是源目录的路径，即 rsync 命令要复制的文件和目录所在的位置。在这个例子中，它指的是 Hugo 网站生成的公共（public）目录。 $NGINX_SERVER_PATH: 这是目标目录的路径，即文件将被同步到的位置。这个变量应该被设置为你的 Nginx 服务器上用于托管网站的目录的路径。例如，它可能是 /var/www/mysite。 总的来说，这个命令将把 ~/projects/blogs/hugo/public/ 目录中的内容同步到 $NGINX_SERVER_PATH 指定的目录中，同时保持文件权限和结构不变，并删除目标目录中那些在源目录不存在的文件。这个命令通常用于确保网站的内容是最新的，同时移除不再需要的文件。\n","wordCount":"464","inLanguage":"en","image":"//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2023-12-16T00:00:00Z","dateModified":"2023-12-16T00:00:00Z","author":{"@type":"Person","name":"sirius1y"},"mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/posts/notes/dev/%E5%8D%9A%E5%AE%A2nginx%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91/"},"publisher":{"@type":"Organization","name":"Sirius' Blog","logo":{"@type":"ImageObject","url":"//localhost:1313/images/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=//localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/archives/ title=Archives><span>Archives</span></a></li><li><a href=//localhost:1313/categories/ title=Categories><span>Categories</span></a></li><li><a href=//localhost:1313/posts/ title=Posts><span>Posts</span></a></li><li><a href=//localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=//localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">把blog部署到华为云nginx</h1><div class=post-description>这篇文章记录了把本地的博客部署到华为云ubuntu的nginx</div><div class=post-meta><span title='2023-12-16 00:00:00 +0000 UTC'>December 16, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;464 words&nbsp;·&nbsp;sirius1y</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%b5%b7%e5%9b%a0 aria-label=起因>起因</a></li><li><a href=#%e5%9c%a8%e4%ba%91%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e5%ae%89%e8%a3%85nginx aria-label=在云服务器上安装nginx>在云服务器上安装nginx</a><ul><li><a href=#nginx%e7%9a%84%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4 aria-label=nginx的常用命令>nginx的常用命令</a></li></ul></li><li><a href=#%e6%8a%8a%e6%9c%ac%e5%9c%b0%e7%9a%84public%e4%b8%8b%e7%9a%84%e6%96%87%e4%bb%b6%e5%a4%8d%e5%88%b6%e5%88%b0%e4%ba%91%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a aria-label=把本地的public/下的文件复制到云服务器上>把本地的public/下的文件复制到云服务器上</a></li><li><a href=#%e9%85%8d%e7%bd%aenginx aria-label=配置nginx>配置nginx</a></li><li><a href=#%e5%ae%9e%e7%8e%b0%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2 aria-label=实现自动部署>实现自动部署</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=起因>起因<a hidden class=anchor aria-hidden=true href=#起因>#</a></h2><p>本来博客是一直使用github pages进行部署的，但是国内的github.io太慢了，并且刚好在年末促销买了一台一年的华为云服务器，就想试一试。</p><h2 id=在云服务器上安装nginx>在云服务器上安装nginx<a hidden class=anchor aria-hidden=true href=#在云服务器上安装nginx>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install nginx
</span></span></code></pre></div><h3 id=nginx的常用命令>nginx的常用命令<a hidden class=anchor aria-hidden=true href=#nginx的常用命令>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 启动 Nginx 服务</span>
</span></span><span class=line><span class=cl>sudo systemctl start nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 停止 Nginx 服务</span>
</span></span><span class=line><span class=cl>sudo systemctl stop nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重新启动 Nginx 服务（用于配置更改后使更改生效）</span>
</span></span><span class=line><span class=cl>sudo systemctl restart nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重新加载 Nginx 配置文件（不中断服务）</span>
</span></span><span class=line><span class=cl>sudo systemctl reload nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查 Nginx 服务的状态</span>
</span></span><span class=line><span class=cl>sudo systemctl status nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试配置文件的正确性（在实际重新加载或重启 Nginx 之前）</span>
</span></span><span class=line><span class=cl>sudo nginx -t
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 显示 Nginx 的版本和配置选项</span>
</span></span><span class=line><span class=cl>nginx -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置 Nginx 开机自动启动</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 禁用 Nginx 开机自动启动</span>
</span></span><span class=line><span class=cl>sudo systemctl disable nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 Nginx 的错误日志（路径可能根据安装和配置有所不同）</span>
</span></span><span class=line><span class=cl>sudo tail -f /var/log/nginx/error.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 Nginx 的访问日志（路径可能根据安装和配置有所不同）</span>
</span></span><span class=line><span class=cl>sudo tail -f /var/log/nginx/access.log
</span></span></code></pre></div><h2 id=把本地的public下的文件复制到云服务器上>把本地的public/下的文件复制到云服务器上<a hidden class=anchor aria-hidden=true href=#把本地的public下的文件复制到云服务器上>#</a></h2><p>nginx默认的起始欢迎页面在/var/www/html/index.nginx-debian.html；</p><p>而我们可以把博客的public文件夹放在/var/www/sites/下面，即博客的index在/var/www/sites/public/index.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 本地执行</span>
</span></span><span class=line><span class=cl>scp -r public username@hostname:~/mysites
</span></span><span class=line><span class=cl>ssh username@hostname
</span></span><span class=line><span class=cl><span class=c1># 云服务器上</span>
</span></span><span class=line><span class=cl>sudo cp -r mysites /var/www/mysites
</span></span></code></pre></div><h2 id=配置nginx>配置nginx<a hidden class=anchor aria-hidden=true href=#配置nginx>#</a></h2><p>nginx的配置文件在/etc/nginx/site-available/，在这个文件夹下有一个默认的配置文件default。</p><p>把default复制一份，再进行修改。</p><p>主要修改就是<strong>sever_name部分</strong>，改为自己的域名；同时<strong>把root的路径指向包含博客index.html的目录</strong>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>        listen <span class=m>80</span> default_server<span class=p>;</span>
</span></span><span class=line><span class=cl>        listen <span class=o>[</span>::<span class=o>]</span>:80 default_server<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># SSL configuration</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1># listen 443 ssl default_server;</span>
</span></span><span class=line><span class=cl>        <span class=c1># listen [::]:443 ssl default_server;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1># Note: You should disable gzip for SSL traffic.</span>
</span></span><span class=line><span class=cl>        <span class=c1># See: https://bugs.debian.org/773332</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1># Read up on ssl_ciphers to ensure a secure configuration.</span>
</span></span><span class=line><span class=cl>        <span class=c1># See: https://bugs.debian.org/765782</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1># Self signed certs generated by the ssl-cert package</span>
</span></span><span class=line><span class=cl>        <span class=c1># Don&#39;t use them in a production server!</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1># include snippets/snakeoil.conf;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        root /var/www/mysites/public<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Add index.php to the list if you are using PHP</span>
</span></span><span class=line><span class=cl>        index index.html index.htm index.nginx-debian.html<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        server_name sirius1y.me<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        location / <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1># First attempt to serve request as file, then</span>
</span></span><span class=line><span class=cl>                <span class=c1># as directory, then fall back to displaying a 404.</span>
</span></span><span class=line><span class=cl>                try_files <span class=nv>$uri</span> <span class=nv>$uri</span>/ <span class=o>=</span>404<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># pass PHP scripts to FastCGI server</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#location ~ \.php$ {</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       include snippets/fastcgi-php.conf;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       # With php-fpm (or other unix sockets):</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       fastcgi_pass unix:/run/php/php7.4-fpm.sock;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       # With php-cgi (or other tcp sockets):</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       fastcgi_pass 127.0.0.1:9000;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># deny access to .htaccess files, if Apache&#39;s document root</span>
</span></span><span class=line><span class=cl>        <span class=c1># concurs with nginx&#39;s one</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#location ~ /\.ht {</span>
</span></span><span class=line><span class=cl>        <span class=c1>#       deny all;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>然后使用IP和域名进行访问就OK了。记得启动nginx服务器就是了：<code>sudo systemctl start nginx</code></p><h2 id=实现自动部署>实现自动部署<a hidden class=anchor aria-hidden=true href=#实现自动部署>#</a></h2><p>我想要实现在本地写完笔记之后先把源码上传到dev-hugo上，并且部署到master分支上，同时把public部署到nginx上。</p><p>原来的脚本，实现了前两个功能，并且能够自动添加更改的文件的提交信息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 定义FILES变量</span>
</span></span><span class=line><span class=cl><span class=nv>FILES</span><span class=o>=</span><span class=k>$(</span><span class=nb>cd</span> /home/yoho/projects/blogs/hugo/content/posts/Notes <span class=o>&amp;&amp;</span> git status --porcelain <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> paste -sd, -<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 同步笔记到sirius2alpha/Notes</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------start---同步笔记到sirius2alpha/Notes------------------------
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/yoho/projects/blogs/hugo/content/posts/Notes
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;update: </span><span class=nv>$FILES</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git pull
</span></span><span class=line><span class=cl>git push
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------end---同步笔记到sirius2alpha/Notes------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sync dev-hugo branch </span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------start---sync dev-hugo branch------------------------------
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/yoho/projects/blogs/hugo
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;update: </span><span class=nv>$FILES</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git pull
</span></span><span class=line><span class=cl>git push
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------end---sync dev-hugo branch------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># build</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/projects/blogs/hugo
</span></span><span class=line><span class=cl>hugo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># master branch only push</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------start---master branch-------------------------------------
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/projects/blogs/hugo/public
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;feat: </span><span class=nv>$FILES</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git push origin master
</span></span><span class=line><span class=cl><span class=nb>echo</span> ------------------------end---master branch-------------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 部署到 Nginx 服务器，和/etc/nginx/sites-available/mysite中的root一致</span>
</span></span><span class=line><span class=cl><span class=nv>NGINX_SERVER_PATH</span><span class=o>=</span><span class=s2>&#34;/var/www/mysites&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 rsync 同步 public 目录到 Nginx 服务器的相应目录</span>
</span></span><span class=line><span class=cl>rsync -av --delete -e <span class=s2>&#34;ssh -p 22&#34;</span> ~/projects/blogs/hugo/public/ root@1.94.126.139:<span class=nv>$NGINX_SERVER_PATH</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重启 Nginx 服务</span>
</span></span><span class=line><span class=cl>ssh root@1.94.126.139 <span class=s2>&#34;sudo systemctl reload nginx&#34;</span>
</span></span></code></pre></div><p><code>rsync -av --delete ~/projects/blogs/hugo/public/ $NGINX_SERVER_PATH</code> 命令的意思是：</p><ul><li><code>rsync</code>: 这是一个非常强大的文件和目录同步工具，广泛用于备份和镜像目的。</li><li><code>-av</code>: 这是两个选项的组合。<ul><li><code>-a</code> 或 <code>--archive</code> 表示启用归档模式，这会保留符号链接、设备、属性、权限、所有权等信息，并且会递归复制目录。</li><li><code>-v</code> 或 <code>--verbose</code> 表示详细模式，会显示关于正在执行的同步操作的更多信息。</li></ul></li><li><code>--delete</code>: 这个选项会在同步过程中删除目标目录中存在而源目录中不存在的文件。这确保目标目录是源目录的精确镜像，包括移除已经在源目录中被删除的文件。</li><li><code>~/projects/blogs/hugo/public/</code>: 这是源目录的路径，即 <code>rsync</code> 命令要复制的文件和目录所在的位置。在这个例子中，它指的是 Hugo 网站生成的公共（public）目录。</li><li><code>$NGINX_SERVER_PATH</code>: 这是目标目录的路径，即文件将被同步到的位置。这个变量应该被设置为你的 Nginx 服务器上用于托管网站的目录的路径。例如，它可能是 <code>/var/www/mysite</code>。</li></ul><p>总的来说，这个命令将把 <code>~/projects/blogs/hugo/public/</code> 目录中的内容同步到 <code>$NGINX_SERVER_PATH</code> 指定的目录中，同时保持文件权限和结构不变，并删除目标目录中那些在源目录不存在的文件。这个命令通常用于确保网站的内容是最新的，同时移除不再需要的文件。</p></div><footer class=post-footer><ul class=post-tags><li><a href=//localhost:1313/tags/blog/>Blog</a></li><li><a href=//localhost:1313/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/>云服务器</a></li><li><a href=//localhost:1313/tags/nginx/>Nginx</a></li><li><a href=//localhost:1313/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/>Web服务器</a></li></ul><nav class=paginav><a class=prev href=//localhost:1313/posts/notes/ubuntu/%E8%BE%93%E5%85%A5%E6%B3%95rime%E4%B8%AD%E5%B7%9E%E9%9F%B5%E9%85%8D%E7%BD%AEibus-rime/><span class=title>« Prev</span><br><span>ubuntu输入法RIME中州韵配置ibus-rime</span>
</a><a class=next href=//localhost:1313/posts/notes/cloud-native/docker%E5%92%8Ck8s%E9%83%A8%E7%BD%B2/><span class=title>Next »</span><br><span>Docker和K8S部署</span></a></nav></footer><script>function createGiscusScript(e){const t=document.createElement("script");Object.entries(e).forEach(([e,n])=>t.setAttribute(e,n)),document.querySelector("article").appendChild(t);const n=document.querySelector('label[for="switch_default"]');n&&n.addEventListener("click",function(){const e=document.body.classList.contains("dark")?"transparent_dark":"light";t.setAttribute("data-theme",e),sendMessage({setConfig:{theme:e}})})}function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}document.addEventListener("DOMContentLoaded",function(){const e={src:"https://giscus.app/client.js","data-repo":"yunyit/yunyit.github.io","data-repo-id":"R_kgDOKqkPYw","data-category":"Comments","data-category-id":"DIC_kwDOKqkPY84CceDi","data-mapping":"url","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-lang":"en",crossorigin:"anonymous",async:""};e["data-theme"]=document.body.classList.contains("dark")?"transparent_dark":"light",createGiscusScript(e);const t=new MutationObserver(()=>{const e=document.body.classList.contains("dark")?"transparent_dark":"light";sendMessage({setConfig:{theme:e}})});t.observe(document.body,{attributes:!0,attributeFilter:["class"]})})</script></article></main><footer class=footer><span><a href=https://us.umami.is/websites/5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4 rel="noopener noreferrer" target=_blank>Analysis</a>
</span>|
<script defer src=https://cloud.umami.is/script.js data-website-id=5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4></script><span><a href=https://beian.miit.gov.cn/ target=_blank>渝ICP备2024018631号</a>
</span>|
<span>&copy; 2024 <a href=//localhost:1313/>Sirius' Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>