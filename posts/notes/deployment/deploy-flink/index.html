<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>尝试在云服务器上部署 Flink 并提交计算任务 | Sirius' Blog</title>
<meta name=keywords content="Kubernetes,Flink,数据库原理,deployment"><meta name=description content="裸机 & K8S上部署flink，并提交计算任务"><meta name=author content="sirius1y"><link rel=canonical href=https://sirius1y.top/posts/notes/deployment/deploy-flink/><link crossorigin=anonymous href=/assets/css/stylesheet.3551607c8eb1ef998f0b6c81d22f9f03dd2c3b8ecaf983e42c023e8d41e39f66.css integrity="sha256-NVFgfI6x75mPC2yB0i+fA90sO47K+YPkLAI+jUHjn2Y=" rel="preload stylesheet" as=style><link rel=icon href=https://sirius1y.top/images/icon.png><link rel=icon type=image/png sizes=16x16 href=https://sirius1y.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sirius1y.top/favicon-32x32.png><link rel=apple-touch-icon href=https://sirius1y.top/apple-touch-icon.png><link rel=mask-icon href=https://sirius1y.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://sirius1y.top/posts/notes/deployment/deploy-flink/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="尝试在云服务器上部署 Flink 并提交计算任务"><meta property="og:description" content="裸机 & K8S上部署flink，并提交计算任务"><meta property="og:type" content="article"><meta property="og:url" content="https://sirius1y.top/posts/notes/deployment/deploy-flink/"><meta property="og:image" content="https://sirius1y.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-15T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-15T00:00:00+00:00"><meta property="og:site_name" content="Sirius' Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sirius1y.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="尝试在云服务器上部署 Flink 并提交计算任务"><meta name=twitter:description content="裸机 & K8S上部署flink，并提交计算任务"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sirius1y.top/posts/"},{"@type":"ListItem","position":2,"name":"尝试在云服务器上部署 Flink 并提交计算任务","item":"https://sirius1y.top/posts/notes/deployment/deploy-flink/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"尝试在云服务器上部署 Flink 并提交计算任务","name":"尝试在云服务器上部署 Flink 并提交计算任务","description":"裸机 \u0026 K8S上部署flink，并提交计算任务","keywords":["Kubernetes","Flink","数据库原理","deployment"],"articleBody":"网站相似度计算：裸机 \u0026 Kubernetes 部署实战 背景与目标 任务：基于 Flink Table API，用 SQL 计算网站间的相似度（Jaccard Coefficient）。 数据：referrer-referree 格式的 CSV，数千到数万条记录。 目标： 跑通 Flink Job，并且能够在外部访问 flink web ui 在K8S集群中部署flink，能够使用多台机器共同计算较大的数据集 一些常用命令备忘：\n## 将文本文件转换为csv # 1. 添加表头 echo \"referrer,referree\" \u003e medium_relation.csv # 2. 替换空格为逗号并追加到新文件 sed 's/ /,/g' medium_relation \u003e\u003e medium_relation.csv ## 压缩和解压缩 tar -czvf xxx tar -xzvf xxx.tar.gz -C ~/ # -c 创建一个新的 tar 文件 # -x 解压文件 # -z 使用gzip压缩 后缀为.tar.gz # -j 使用bzip2压缩 后缀为.tar.bz2 # -v 显示详细的压缩过程 # -f 指定 tar 文件的名称 # -C 指定解压缩包的目录 ## 下载文件 curl -L -o helm-v3.7.0.tar.gz https://github.com/helm/helm/releases/download/v3.7.0/helm-v3.7.0-linux-amd64.tar.gz # -L：表示跟随重定向（很多 GitHub 下载链接会重定向到实际的下载 URL） # -o helm-v3.7.0.tar.gz：指定下载文件的保存文件名 wget https://github.com/helm/helm/releases/download/v3.7.0/helm-v3.7.0-linux-amd64.tar.gz # wget 在下载时会自动保存文件到当前目录，文件名通常是 URL 中最后的部分 一、裸机部署 Flink 环境安装 \u0026 启动 Flink Flink 1.16.2 Java 8 Maven 3.9.4 flink 安装好了之后修改flink/conf/flink-conf.yaml中的rest.address和rest.band.address为0.0.0.0（为了能够从webui进行查看，当然别忘了修改防火墙配置）\n并且使用scripts/start-cluster.sh启动 Flink\n项目代码 maven 依赖 \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ","wordCount":"885","inLanguage":"en","image":"https://sirius1y.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-05-15T00:00:00Z","dateModified":"2025-05-15T00:00:00Z","author":{"@type":"Person","name":"sirius1y"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sirius1y.top/posts/notes/deployment/deploy-flink/"},"publisher":{"@type":"Organization","name":"Sirius' Blog","logo":{"@type":"ImageObject","url":"https://sirius1y.top/images/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sirius1y.top/ accesskey=h title="Home (Alt + H)"><img src=https://sirius1y.top/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sirius1y.top/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://sirius1y.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://sirius1y.top/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://sirius1y.top/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sirius1y.top/>Home</a>&nbsp;»&nbsp;<a href=https://sirius1y.top/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">尝试在云服务器上部署 Flink 并提交计算任务</h1><div class=post-description>裸机 & K8S上部署flink，并提交计算任务</div><div class=post-meta><span title='2025-05-15 00:00:00 +0000 UTC'>May 15, 2025</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;885 words&nbsp;·&nbsp;sirius1y</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%bd%91%e7%ab%99%e7%9b%b8%e4%bc%bc%e5%ba%a6%e8%ae%a1%e7%ae%97%e8%a3%b8%e6%9c%ba--kubernetes-%e9%83%a8%e7%bd%b2%e5%ae%9e%e6%88%98 aria-label="网站相似度计算：裸机 &amp;amp; Kubernetes 部署实战">网站相似度计算：裸机 & Kubernetes 部署实战</a><ul><li><a href=#%e8%83%8c%e6%99%af%e4%b8%8e%e7%9b%ae%e6%a0%87 aria-label=背景与目标>背景与目标</a></li><li><a href=#%e4%b8%80%e8%a3%b8%e6%9c%ba%e9%83%a8%e7%bd%b2-flink aria-label="一、裸机部署 Flink">一、裸机部署 Flink</a><ul><li><a href=#%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85--%e5%90%af%e5%8a%a8-flink aria-label="环境安装 &amp;amp; 启动 Flink">环境安装 & 启动 Flink</a></li><li><a href=#%e9%a1%b9%e7%9b%ae%e4%bb%a3%e7%a0%81 aria-label=项目代码>项目代码</a><ul><li><a href=#maven-%e4%be%9d%e8%b5%96 aria-label="maven 依赖">maven 依赖</a></li><li><a href=#java-%e4%bb%a3%e7%a0%81 aria-label="Java 代码">Java 代码</a></li></ul></li><li><a href=#%e7%bc%96%e8%af%91--%e9%83%a8%e7%bd%b2 aria-label="编译 &amp;amp; 部署">编译 & 部署</a></li></ul></li><li><a href=#%e4%ba%8ckubernetes-%e9%83%a8%e7%bd%b2-flink aria-label="二、Kubernetes 部署 Flink">二、Kubernetes 部署 Flink</a><ul><li><a href=#%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6 aria-label=前提条件>前提条件</a></li><li><a href=#%e5%ae%89%e8%a3%85-operator aria-label="安装 Operator">安装 Operator</a></li><li><a href=#%e7%bc%96%e5%86%99%e9%83%a8%e7%bd%b2yaml aria-label=编写部署YAML>编写部署YAML</a></li><li><a href=#%e9%83%a8%e7%bd%b2 aria-label=部署>部署</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=网站相似度计算裸机--kubernetes-部署实战>网站相似度计算：裸机 & Kubernetes 部署实战<a hidden class=anchor aria-hidden=true href=#网站相似度计算裸机--kubernetes-部署实战>#</a></h1><h2 id=背景与目标>背景与目标<a hidden class=anchor aria-hidden=true href=#背景与目标>#</a></h2><ul><li><strong>任务</strong>：基于 Flink Table API，用 SQL 计算网站间的相似度（Jaccard Coefficient）。</li><li><strong>数据</strong>：<code>referrer-referree</code> 格式的 CSV，数千到数万条记录。</li><li><strong>目标</strong>：<ol><li>跑通 Flink Job，并且能够在外部访问 flink web ui</li><li>在K8S集群中部署flink，能够使用多台机器共同计算较大的数据集</li></ol></li></ul><p>一些常用命令备忘：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 将文本文件转换为csv</span>
</span></span><span class=line><span class=cl><span class=c1># 1. 添加表头</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;referrer,referree&#34;</span> &gt; medium_relation.csv
</span></span><span class=line><span class=cl><span class=c1># 2. 替换空格为逗号并追加到新文件</span>
</span></span><span class=line><span class=cl>sed <span class=s1>&#39;s/ /,/g&#39;</span> medium_relation &gt;&gt; medium_relation.csv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 压缩和解压缩</span>
</span></span><span class=line><span class=cl>tar -czvf xxx
</span></span><span class=line><span class=cl>tar -xzvf xxx.tar.gz -C ~/
</span></span><span class=line><span class=cl><span class=c1># -c 创建一个新的 tar 文件</span>
</span></span><span class=line><span class=cl><span class=c1># -x 解压文件</span>
</span></span><span class=line><span class=cl><span class=c1># -z 使用gzip压缩 后缀为.tar.gz</span>
</span></span><span class=line><span class=cl><span class=c1># -j 使用bzip2压缩 后缀为.tar.bz2 </span>
</span></span><span class=line><span class=cl><span class=c1># -v 显示详细的压缩过程</span>
</span></span><span class=line><span class=cl><span class=c1># -f 指定 tar 文件的名称</span>
</span></span><span class=line><span class=cl><span class=c1># -C 指定解压缩包的目录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 下载文件</span>
</span></span><span class=line><span class=cl>curl -L -o helm-v3.7.0.tar.gz https://github.com/helm/helm/releases/download/v3.7.0/helm-v3.7.0-linux-amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># -L：表示跟随重定向（很多 GitHub 下载链接会重定向到实际的下载 URL）</span>
</span></span><span class=line><span class=cl><span class=c1># -o helm-v3.7.0.tar.gz：指定下载文件的保存文件名</span>
</span></span><span class=line><span class=cl>wget https://github.com/helm/helm/releases/download/v3.7.0/helm-v3.7.0-linux-amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># wget 在下载时会自动保存文件到当前目录，文件名通常是 URL 中最后的部分</span>
</span></span></code></pre></div><h2 id=一裸机部署-flink>一、裸机部署 Flink<a hidden class=anchor aria-hidden=true href=#一裸机部署-flink>#</a></h2><h3 id=环境安装--启动-flink>环境安装 & 启动 Flink<a hidden class=anchor aria-hidden=true href=#环境安装--启动-flink>#</a></h3><ul><li>Flink 1.16.2</li><li>Java 8</li><li>Maven 3.9.4</li></ul><p>flink 安装好了之后修改<code>flink/conf/flink-conf.yaml</code>中的<code>rest.address</code>和<code>rest.band.address</code>为<code>0.0.0.0</code>（为了能够从webui进行查看，当然别忘了修改防火墙配置）</p><p>并且使用<code>scripts/start-cluster.sh</code>启动 Flink</p><h3 id=项目代码>项目代码<a hidden class=anchor aria-hidden=true href=#项目代码>#</a></h3><h4 id=maven-依赖>maven 依赖<a hidden class=anchor aria-hidden=true href=#maven-依赖>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>cn.edu.shu<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>websitesimilarity<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;packaging&gt;</span>jar<span class=nt>&lt;/packaging&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;name&gt;</span>WebsiteSimilarity<span class=nt>&lt;/name&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;description&gt;</span>Website Similarity Calculation using Flink<span class=nt>&lt;/description&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.compiler.source&gt;</span>1.8<span class=nt>&lt;/maven.compiler.source&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.compiler.target&gt;</span>1.8<span class=nt>&lt;/maven.compiler.target&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Flink Streaming Java --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>flink-streaming-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>1.16.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Flink Clients --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>flink-clients<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>1.16.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Flink Java --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>flink-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>1.16.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>flink-table-api-java-bridge<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>1.17.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>flink-csv<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>1.17.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- Maven Compiler Plugin --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.8.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;source&gt;</span>1.8<span class=nt>&lt;/source&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;target&gt;</span>1.8<span class=nt>&lt;/target&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></div><h4 id=java-代码>Java 代码<a hidden class=anchor aria-hidden=true href=#java-代码>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>package</span><span class=w> </span><span class=n>cn</span><span class=p>.</span><span class=n>edu</span><span class=p>.</span><span class=n>shu</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>import</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=n>apache</span><span class=p>.</span><span class=n>flink</span><span class=p>.</span><span class=k>table</span><span class=p>.</span><span class=n>api</span><span class=p>.</span><span class=n>EnvironmentSettings</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>import</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=n>apache</span><span class=p>.</span><span class=n>flink</span><span class=p>.</span><span class=k>table</span><span class=p>.</span><span class=n>api</span><span class=p>.</span><span class=k>Table</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>import</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=n>apache</span><span class=p>.</span><span class=n>flink</span><span class=p>.</span><span class=k>table</span><span class=p>.</span><span class=n>api</span><span class=p>.</span><span class=n>TableEnvironment</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 最简单的基于 SQL 的网站相似度计算
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>public</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=n>WebsiteSimilarityJob</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>public</span><span class=w> </span><span class=k>static</span><span class=w> </span><span class=n>void</span><span class=w> </span><span class=n>main</span><span class=p>(</span><span class=n>String</span><span class=p>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=n>throws</span><span class=w> </span><span class=k>Exception</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>创建</span><span class=w> </span><span class=n>Flink</span><span class=w> </span><span class=k>Table</span><span class=w> </span><span class=err>环境（批处理模式）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>EnvironmentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EnvironmentSettings</span><span class=p>.</span><span class=n>newInstance</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=n>inBatchMode</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=n>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TableEnvironment</span><span class=w> </span><span class=n>tEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=k>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>CSV</span><span class=w> </span><span class=err>文件路径，确保文件已转换成</span><span class=w> </span><span class=n>referrer</span><span class=p>,</span><span class=w> </span><span class=n>referree</span><span class=w> </span><span class=err>格式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>inputPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;file:///home/ubuntu/similarity_app/medium_relation.csv&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>outputPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;file:///home/ubuntu/similarity_app/output_result.csv&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>注册源表</span><span class=w> </span><span class=n>links</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tEnv</span><span class=p>.</span><span class=n>executeSql</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;CREATE TEMPORARY TABLE links (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; referrer BIGINT, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; referree BIGINT&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;) WITH (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;connector&#39; = &#39;filesystem&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;path&#39; = &#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>inputPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;format&#39; = &#39;csv&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;csv.ignore-parse-errors&#39; = &#39;true&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>计算相似度，并取前</span><span class=mi>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Table</span><span class=w> </span><span class=k>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tEnv</span><span class=p>.</span><span class=n>sqlQuery</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;WITH website_union AS (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;   SELECT wl1.referrer AS website_A, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;          wl2.referrer AS website_B, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;          wl1.referree AS referree_A, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;          wl2.referree AS referree_B &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;   FROM links wl1 &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;   JOIN links wl2 &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;     ON wl1.referree = wl2.referree &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;   WHERE wl1.referrer &lt;&gt; wl2.referrer &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;) &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;SELECT website_A, website_B, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;       COUNT(DISTINCT referree_A) * 1.0 / &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;       (SELECT COUNT(DISTINCT referree) FROM (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;         SELECT referree_A AS referree FROM website_union &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;         UNION &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;         SELECT referree_B AS referree FROM website_union)) AS similarity &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;FROM website_union &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;GROUP BY website_A, website_B &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;LIMIT 50&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>注册输出表，将结果保存到文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tEnv</span><span class=p>.</span><span class=n>executeSql</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;CREATE TEMPORARY TABLE output_result (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; website_A BIGINT, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; website_B BIGINT, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; similarity DOUBLE&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;) WITH (&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;connector&#39; = &#39;filesystem&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;path&#39; = &#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>outputPath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;format&#39; = &#39;csv&#39;, &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34; &#39;csv.field-delimiter&#39; = &#39;,&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=err>设置字段分隔符为逗号</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s2>&#34;)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>将结果写入文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>result</span><span class=p>.</span><span class=n>executeInsert</span><span class=p>(</span><span class=s2>&#34;output_result&#34;</span><span class=p>).</span><span class=n>await</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>输出完成信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>System</span><span class=p>.</span><span class=k>out</span><span class=p>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;Result has been saved to: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>outputPath</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=编译--部署>编译 & 部署<a hidden class=anchor aria-hidden=true href=#编译--部署>#</a></h3><pre tabindex=0><code>mvn package
flink run --class cn.edu.shu.WebsiteSimilarityJob ~/similarity_app/target/xxx.jar
</code></pre><p>然后作业就会提交到Flink中，可以在web UI上查看进度</p><ul><li><strong><code>!=</code> 不被支持</strong> → 改用 SQL 标准 <code>&lt;></code>。</li><li><strong>多字段 <code>COUNT(DISTINCT a,b)</code> 不支持</strong> → 重写子查询。</li></ul><h2 id=二kubernetes-部署-flink>二、Kubernetes 部署 Flink<a hidden class=anchor aria-hidden=true href=#二kubernetes-部署-flink>#</a></h2><p>:arrow_right: <a href=https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-release-1.11/zh/docs/try-flink-kubernetes-operator/quick-start/>Apache Flink 官方参考指南</a></p><h3 id=前提条件>前提条件<a hidden class=anchor aria-hidden=true href=#前提条件>#</a></h3><p>确保安装了docker , kubernetes , helm</p><p>helm 和 kubernetes 的版本需要匹配，可查询:arrow_right: <a href=https://helm.sh/docs/intro/quickstart/>Helm官方文档</a></p><h3 id=安装-operator>安装 Operator<a hidden class=anchor aria-hidden=true href=#安装-operator>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add flink-operator-repo https://downloads.apache.org/flink/flink-kubernetes-operator-1.11.0/
</span></span><span class=line><span class=cl>helm install flink-kubernetes-operator flink-operator-repo/flink-kubernetes-operator
</span></span></code></pre></div><p><strong>Flink Kubernetes Operator</strong> 的作用就是 <strong>识别 YAML 配置文件中的 <code>FlinkDeployment</code> 类型，并根据配置自动执行相关的操作</strong>。它实际上是一个 <strong>Kubernetes 控制器</strong>，负责管理和协调 Kubernetes 集群中的 Flink 集群的生命周期。</p><p><strong>Flink Kubernetes Operator 工作流程</strong>：</p><ol><li><strong>提交 <code>FlinkDeployment</code></strong>：<ul><li>您通过 <code>kubectl apply -f flink-deployment.yaml</code> 提交一个包含 Flink 集群配置的 YAML 文件（<code>FlinkDeployment</code>）。</li></ul></li><li><strong>Operator 监控 <code>FlinkDeployment</code></strong>：<ul><li>Flink Kubernetes Operator 会监听 Kubernetes 中的 <code>FlinkDeployment</code> 资源。</li><li>一旦 <code>FlinkDeployment</code> 被创建或更新，Operator 会识别该资源，并根据其内容执行相关操作。</li></ul></li><li><strong>创建和管理资源</strong>：<ul><li>根据 <code>FlinkDeployment</code> 中的配置，Operator 会自动创建和管理 Kubernetes 中的 <strong>JobManager</strong> 和 <strong>TaskManager</strong> Pods。</li><li>它会根据配置中的 <strong><code>replicas</code>、<code>resource</code>、<code>image</code></strong> 等字段来启动相应的资源。</li></ul></li><li><strong>更新集群</strong>：<ul><li>如果您更改了 <code>FlinkDeployment</code> 中的配置（例如，修改镜像版本或调整资源），Operator 会自动处理集群的升级和更新。</li><li>例如，您更改了镜像版本，Operator 会根据新配置启动新的 Pods，替换旧的 Pods。</li></ul></li></ol><h3 id=编写部署yaml>编写部署YAML<a hidden class=anchor aria-hidden=true href=#编写部署yaml>#</a></h3><p>一个官方测试的一个YAML脚本 be like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>flink.apache.org/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>FlinkDeployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>basic-example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>flink:1.20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>flinkVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1_20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>flinkConfiguration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>taskmanager.numberOfTaskSlots</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceAccount</span><span class=p>:</span><span class=w> </span><span class=l>flink</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jobManager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2048m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>taskManager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2048m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jarURI</span><span class=p>:</span><span class=w> </span><span class=l>local:///opt/flink/examples/streaming/StateMachineExample.jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parallelism</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>upgradeMode</span><span class=p>:</span><span class=w> </span><span class=l>stateless</span><span class=w>
</span></span></span></code></pre></div><p>其中指定了 flink 的 image 版本，还有 jobManager 和 taskManager 的数量和配置等，再在job中指定了运行的 jar 的 URI 。</p><p>如果是分布式环境的话，需要确保 JAR 在一个大家都能访问得到的地方。</p><blockquote><p>GPT说有以下几种方法可以尝试：</p><ul><li>方法 1: 使用 Kubernetes ConfigMap 上传 JAR 文件</li></ul><p>​ <strong>ConfigMap</strong> 是一种 Kubernetes 资源对象，主要用于存储配置文件、环境变量等文本数据。您可以将 JAR 文件作为 ConfigMap 存储在 Kubernetes 中。</p><ul><li>方法 2: 使用 Kubernetes Persistent Volume (PV)</li></ul><p>​ <strong>Persistent Volume (PV)</strong> 允许您将外部存储（如 NFS、Ceph、AWS EBS 等）挂载到 Kubernetes 中，供容器访问。</p><ul><li>方法 3: 使用云存储（如 AWS S3）</li></ul><p>​ 如果您的 Kubernetes 集群在 AWS 上，您可以将 JAR 文件上传到 <strong>S3</strong> 存储桶，并通过 <code>jarURI</code> 引用它。</p></blockquote><p>因为我的这个JAR很小，大小仅 3.5 KB（可以通过<code>ls -lh</code>查看） → 选用 ConfigMap 共享</p><p>用 kubectl 对 JAR 文件进行挂载：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create configmap flink-job-jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --from-file<span class=o>=</span>websitesimilarity-1.0-SNAPSHOT.jar<span class=o>=</span>target/websitesimilarity-1.0-SNAPSHOT.jar
</span></span></code></pre></div><p><strong>ConfigMap 更新</strong>：每次 Jar 变动都需 <code>kubectl delete configmap && create configmap</code></p><p><strong>FlinkDeployment.yaml</strong> 样例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>flink.apache.org/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>FlinkDeployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>basic-example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>flink:1.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>flinkConfiguration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>taskmanager.numberOfTaskSlots</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jobManager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=l>cpu:1, memory:&#34;4096m&#34; }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>podTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMap</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>flink:1.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/opt/flink/jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=l>websitesimilarity-1.0-SNAPSHOT.jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>taskManager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=l>cpu:1, memory:&#34;4096m&#34; }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>podTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMap</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-task-manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>flink:1.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flink-job-jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/opt/flink/jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=l>websitesimilarity-1.0-SNAPSHOT.jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jarURI</span><span class=p>:</span><span class=w> </span><span class=l>local:///opt/flink/jobs/websitesimilarity-1.0-SNAPSHOT.jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parallelism</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>upgradeMode</span><span class=p>:</span><span class=w> </span><span class=l>stateless</span><span class=w>
</span></span></span></code></pre></div><h3 id=部署>部署<a hidden class=anchor aria-hidden=true href=#部署>#</a></h3><ol><li><p><code>kubectl apply -f flink-deployment.yaml</code> → Operator 自动创建 Deployment</p></li><li><p>查看服务：<code>kubectl get svc</code></p><ul><li><code>flinkapp</code> (6123/TCP, 6124/TCP) 内部通信</li><li><code>flinkapp-rest</code> (8081/TCP) Web UI</li></ul></li><li><p>端口转发：</p><p>如果想在本地浏览器中访问，需要加上 &ndash;address 0.0.0.0 的选项，并且记得放开防火墙8085端口</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward --address 0.0.0.0 svc/flinkapp-rest 8085:8081
</span></span></code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://sirius1y.top/tags/kubernetes/>Kubernetes</a></li><li><a href=https://sirius1y.top/tags/flink/>Flink</a></li><li><a href=https://sirius1y.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/>数据库原理</a></li><li><a href=https://sirius1y.top/tags/deployment/>Deployment</a></li></ul><nav class=paginav><a class=prev href=https://sirius1y.top/posts/notes/tools/thunderbird-icloud/><span class=title>« Prev</span><br><span>使用 Thunderbird 同步 iCloud 日历与联系人</span>
</a><a class=next href=https://sirius1y.top/posts/notes/network/split-tunneling/><span class=title>Next »</span><br><span>只让服务器流量走 VPN</span></a></nav></footer><script>function createGiscusScript(e){const t=document.createElement("script");Object.entries(e).forEach(([e,n])=>t.setAttribute(e,n)),document.querySelector("article").appendChild(t);const n=document.querySelector('label[for="switch_default"]');n&&n.addEventListener("click",function(){const e=document.body.classList.contains("dark")?"transparent_dark":"light";t.setAttribute("data-theme",e),sendMessage({setConfig:{theme:e}})})}function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}document.addEventListener("DOMContentLoaded",function(){const e={src:"https://giscus.app/client.js","data-repo":"yunyit/yunyit.github.io","data-repo-id":"R_kgDOKqkPYw","data-category":"Comments","data-category-id":"DIC_kwDOKqkPY84CceDi","data-mapping":"url","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-lang":"en",crossorigin:"anonymous",async:""};e["data-theme"]=document.body.classList.contains("dark")?"transparent_dark":"light",createGiscusScript(e);const t=new MutationObserver(()=>{const e=document.body.classList.contains("dark")?"transparent_dark":"light";sendMessage({setConfig:{theme:e}})});t.observe(document.body,{attributes:!0,attributeFilter:["class"]})})</script></article></main><footer class=footer><span><a href=https://us.umami.is/websites/5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4 rel="noopener noreferrer" target=_blank>Analysis</a>
</span>|
<script defer src=https://cloud.umami.is/script.js data-website-id=5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4></script><span><a href=https://beian.miit.gov.cn/ target=_blank>渝ICP备2024018631号</a>
</span>|
<span>&copy; 2025 <a href=https://sirius1y.top/>Sirius' Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>