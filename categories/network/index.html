<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Network | Sirius' Blog</title>
<meta name=keywords content><meta name=description content="Regret is the enemy."><meta name=author content="sirius1y"><link rel=canonical href=https://sirius1y.top/categories/network/><link crossorigin=anonymous href=/assets/css/stylesheet.3551607c8eb1ef998f0b6c81d22f9f03dd2c3b8ecaf983e42c023e8d41e39f66.css integrity="sha256-NVFgfI6x75mPC2yB0i+fA90sO47K+YPkLAI+jUHjn2Y=" rel="preload stylesheet" as=style><link rel=icon href=https://sirius1y.top/images/icon.png><link rel=icon type=image/png sizes=16x16 href=https://sirius1y.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sirius1y.top/favicon-32x32.png><link rel=apple-touch-icon href=https://sirius1y.top/apple-touch-icon.png><link rel=mask-icon href=https://sirius1y.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://sirius1y.top/categories/network/index.xml><link rel=alternate hreflang=en href=https://sirius1y.top/categories/network/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Network"><meta property="og:description" content="Regret is the enemy."><meta property="og:type" content="website"><meta property="og:url" content="https://sirius1y.top/categories/network/"><meta property="og:image" content="https://sirius1y.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="Sirius' Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sirius1y.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Network"><meta name=twitter:description content="Regret is the enemy."></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sirius1y.top/ accesskey=h title="Home (Alt + H)"><img src=https://sirius1y.top/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sirius1y.top/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://sirius1y.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://sirius1y.top/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://sirius1y.top/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://sirius1y.top/>Home</a>&nbsp;»&nbsp;<a href=https://sirius1y.top/categories/>Categories</a></div><h1>Network
<a href=/categories/network/index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>只让服务器流量走 VPN</h2></header><div class=entry-content><p>背景 服务器在学校的校园网中，然后平时需要使用 Easy Connect 连接学校的 VPN 之后，才能通过 SSH 连接到服务器。但是学校配置的 VPN 又很烦人，会接管本机上的所有流量走校园网，导致访问其他网站的速度很慢，并且连接不上外网用不了 GPT 之类的麻烦。
学校提供的 VPN 服务有两种软件可以使用，一个是 Easy Connect，一种是 Open VPN 。两种我都尝试了，都是登陆的同样的账号，但是openvpn始终ssh连接不上学校内网中的服务器，但是 Easy Connect 却可以。所以之后我都是在 Easy Connect 上进行操作的。
发现问题 发现启动 VPN 软件之后，运行ifconfig可以看到本地会多一个utun*的网络接口，然后运行netstat -rn查看电脑的路由表中可以看到，有大量的路由配置信息指向了这个utun*的网络接口。
之前之所以连接上了 VPN 之后无法正常的访问外网，是因为学校的 VPN 服务器推送了很多的路由，几乎涵盖了从1.*.*.*到255.*.*.*中的所有路由，全部设置为走utun*。即使我的default路由走的是我正常的网口，但是具体的路由的优先级是要比default路由要高的，所以几乎全部都走了 VPN 。
解决思路 有两个方法可以解决这个问题：
1 在Docker上运行 VPN 软件进行转发 在本地启动一个Docker，然后让 VPN 运行在 Docker 内，将走服务器IP地址的流量走到 Docker 容器内，然后在容器内走 VPN 出去。这个方法肯定是可行的，不过感觉稍微麻烦了一点，采用了第二个idea
2 删除多余的路由表 在 VPN 软件启动之后，他不是注册了很多具体的路由嘛，而我的需求只是让服务器流量走 VPN 就可以了，其他的流量不用他管。所以写了一个脚本，在 VPN 软件启动之后运行就行。
脚本主要实现的功能是，在路由表中匹配 VPN 网口的所有路由，只保留我服务器那一条路由，其他的全部删除，就OK，简单又完美。
#!/bin/bash # 示例 # 提示用户输入网络接口名称 read -p "请输入 VPN 网络接口名称（例如utun6）: " vpn_interface # 提示用户输入需要保留的服务器IP地址或网段 read -p "请输入需要保留的服务器IP地址或网段（例如192....</p></div><footer class=entry-footer><span title='2025-01-04 00:00:00 +0000 UTC'>January 4, 2025</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;132 words&nbsp;·&nbsp;sirius1y</footer><a class=entry-link aria-label="post link to 只让服务器流量走 VPN " href=https://sirius1y.top/posts/notes/network/split-tunneling/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>内网穿透——frp和花生壳实现从外部网络访问家中主机</h2></header><div class=entry-content><p>想法产生 主机一般都放在宿舍内的，想要从其他地方访问宿舍内的服务器非常的不方便，但是又奈何宿舍宽带很难申请公网IP，所以才会想到用内网穿透的方式实现对宿舍内主机的访问。
notes 宿舍内都是局域网，连接到的校园网wifi或者宽带分配的IP都会随着重新连接产生变动，所以在此会使用到DDns技术。ddns就是把一个动态变化的IP地址和一个不变的域名绑定在一起，直接访问这个域名就可以实现访问到这个变化的IP地址的作用。 花生壳免费版会赠送一个域名，可以直接实现内网穿透，比较简便； frp适合有一个公网IP，然后通过公网IP的转发实现内网穿透。 在此之前，请确保已经安装openssh-server!!!
花生壳实现 大致流程
在花生壳官网上面下载linux版本的客户端； 安装完成之后在终端中输入： sudo phddns start sudo phddns enable sudo phddns status 然后会出现一个SN码，这个SN码就相当于这个主机的ID，然后在花生壳官网上使用SN码进行登录，密码默认是admin
通过sn登录之后再绑定到注册的花生壳帐号上；再到花生壳内网穿透界面去添加映射，内网地址填127.0.0.1或者是自己的局域网地址好像我都实验成功过。
都设置好之后可以在映射旁边又一个诊断按钮，可以看是否成功了。
在进行ssh连接的时候只需要ssh -o 12345 your_name@xxxxxx.xx就行了；
12345是你的映射上的外网端口，your_name是你的内网的用户名，xxxx.xx是你的域名
可能会出现的问题 首先请查看官方文档
第一步的内网服务和花生壳服务器连接不上 你可以phddns status检查一下他是OFFLINE还是ONLINE的状态，遇到OFFLINE就需要重启服务
等到他变成ONLINE之后，在检查花生壳网站上的最右上角的头像，鼠标悬浮就能看到有一个状态，状态若是离线，但是phddns又是ONLINE，就退出重新登录一下就好了。
同时可以看看左边边栏上有一个设备管理。
frp实现 访问frp的github仓库releases页面：https://github.com/fatedier/frp/releases
frp的官方文档：https://gofrp.org/zh-cn/docs/overview/
通过 SSH 访问内网机器
步骤 在具有公网 IP 的机器上部署 frps
部署 frps 并编辑 frps.toml 文件。以下是简化的配置，其中设置了 frp 服务器用于接收客户端连接的端口：
bindPort = 7000 log_file = /var/log/frps.log 在frps中添加上日志文件的位置/var/log/frps.log，方便查看。
这里还支持dashboard，prometheus监控等功能。 参考配置：https://cloud.tencent.com/developer/article/1837482
[common] # frp监听的端口，默认是7000，可以改成其他的 bind_port = 7000 # 授权码，请改成更复杂的 token = 52010 # 这个token之后在客户端会用到 # frp管理后台端口，请按自己需求更改 dashboard_port = 7500 # frp管理后台用户名和密码，请改成自己的 dashboard_user = admin dashboard_pwd = admin enable_prometheus = true # frp日志配置 log_file = /var/log/frps....</p></div><footer class=entry-footer><span title='2023-12-20 00:00:00 +0000 UTC'>December 20, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;256 words&nbsp;·&nbsp;sirius1y</footer><a class=entry-link aria-label="post link to 内网穿透——frp和花生壳实现从外部网络访问家中主机" href=https://sirius1y.top/posts/notes/network/net-frp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>GNS3+cisco 动态路由实验RIP/OSRF</h2></header><div class=entry-content><p>RIP 网络拓扑图 路由器配置 下面是路由器R1、R2和R3的配置示例:
R1 配置:
configure terminal interface FastEthernet0/0 ip address 10.1.1.1 255.255.255.0 no shutdown exit interface FastEthernet0/1 ip address 172.16.10.1 255.255.255.0 no shutdown exit router rip version 2 network 10.1.1.0 network 172.16.0.0 end wr R2 配置:
configure terminal interface FastEthernet0/0 ip address 10.1.1.2 255.255.255.0 no shutdown exit router rip version 2 network 10.1.1.0 end wr R3 配置:
configure terminal interface FastEthernet0/0 ip address 172.16.10.2 255.255.255.0 no shutdown exit router rip version 2 network 172....</p></div><footer class=entry-footer><span title='2023-10-30 00:00:00 +0000 UTC'>October 30, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;240 words&nbsp;·&nbsp;sirius1y</footer><a class=entry-link aria-label="post link to GNS3+cisco 动态路由实验RIP/OSRF" href=https://sirius1y.top/posts/notes/network/net-riposrf-ongns3/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>GNS3静态路由实验</h2></header><div class=entry-content><p>预备知识 静态路由和动态路由是什么？ 静态路由
静态路由是一种手动配置路由信息的方式，其中网络管理员手动指定每个目的地网络的下一跳路由器或出口。这些手动配置的路由信息通常在网络中不经常更改，因此称为"静态"路由。静态路由通常用于小型网络或需要特定路由路径的特殊情况，例如，将流量定向到特定服务器或分支机构。
静态路由的主要优点是简单和易于管理，因为管理员有完全的控制权。然而，它不适用于大型、复杂的网络，因为手动配置路由信息可能变得非常繁琐，并且难以应对网络拓扑的变化。
动态路由
动态路由是一种更灵活的路由方式，其中路由器能够自动学习网络拓扑和动态地调整路由表。动态路由协议允许路由器之间交换路由信息，以确定最佳路径到达目的地网络。一些常见的动态路由协议包括RIP（Routing Information Protocol）、OSPF（Open Shortest Path First）和BGP（Border Gateway Protocol）等。
动态路由的主要优势在于其自动性和适应性。它适用于大型复杂的网络，因为它能够适应网络拓扑的变化，而无需手动更新路由信息。然而，动态路由也可能引入一些安全和性能方面的考虑，因此需要适当的配置和监控。
GNS3 console 模式介绍 用户 EXEC 模式 该模式下，提示符为“ Router>”，需要了解该模式下可以实用的命令，输入 “ ?”。 特权 EXEC 模式 查看 Cisco 路由器的系统参数，必需进入特权 EXEC 模式，输入命令：
Router1> enable Password: Router1# 全局配置模式 若需要修改系统范围内的配置参数，必需进入全局配置模式。输入命令：
Router1# configure terminal Router1(config)# 接口配置模式 若要修改网络接口，需要进入接口配置模式。输入命令：
Router1(Config)#interface Ethernet 0/0 Router1(config-if)# 返回
Exit 命令：层层返回，即退回到上一个命令层次。
End 命令：从任何模式直接退回到特权 EXEC 模式。
Disable 命令：从特权 EXEC 模式返回到用户 EXEC 模式。即
Router1＃ disable Router1> Logout 命令：从用户 EXEC 模式终止控制台会话，输入 logout。...</p></div><footer class=entry-footer><span title='2023-10-30 00:00:00 +0000 UTC'>October 30, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;360 words&nbsp;·&nbsp;sirius1y</footer><a class=entry-link aria-label="post link to GNS3静态路由实验" href=https://sirius1y.top/posts/notes/network/net-static_router-ongns3/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>常用的网络命令</h2></header><div class=entry-content><p>ipconfig, ifconfig, ip ipconfig是windows中的命令，linux上是ifconfig，但ip命令比ifconfig更强大，旨在取代ifconfig命令。
ping ping命令是DOS命令，一般用于检测网络是否通畅以及网络连接速度，结果只越大，说明速度越慢。它使用网络层的ICMP协议。
ping [参数选项] [主机名或IP地址] linux 参数 含义 -c 设置完成要求回应的次数 -i 指定收发信息的间隔时间 -s 设置数据包的大小 -w 在设定的秒后退出 windows 参数 含义 -t 连续对IP地址执行ping命令，直到用户以&lt;control+c>键强制中断 -l 指定ping命令的数据长度 -n 执行特定次数的ping命令 netstat netstat 用来查看当前操作系统的网络连接状态、路由表、接口统计等信息，来自于 net-tools 工具包，ss 是 netstat 的升级版。
参数 含义 -a 显示主机中所有活动的网络连接信息 (包括监听、非监听状态的服务端口) -n 以数字的形式显示相关的主机地址、端口等信息 -p 显示与网络连接相关联的进程号、进程名称信息 (该选项需要 root 权限) -l 显示处于监听 (Listen) 状态的网络连接及端口信息 -t 查看 TCP (Transmission Control Protocol，传输控制协议) 相关的信息 -u 显示 UDP (User Datagram Protocol，用户数据报协议) 协议相关的信息 -r 显示路由表信息 -i 显示网卡列表 -g 显示组播组的关系 -s 显示网络统计信息 常用命令选项：...</p></div><footer class=entry-footer><span title='2023-10-26 00:00:00 +0000 UTC'>October 26, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;690 words&nbsp;·&nbsp;sirius1y</footer><a class=entry-link aria-label="post link to 常用的网络命令" href=https://sirius1y.top/posts/notes/network/network-commands/></a></article></main><footer class=footer><span><a href=https://us.umami.is/websites/5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4 rel="noopener noreferrer" target=_blank>Analysis</a>
</span>|
<script defer src=https://cloud.umami.is/script.js data-website-id=5e6ac0c1-e2b2-4d0f-9542-b79ac2cf89c4></script><span><a href=https://beian.miit.gov.cn/ target=_blank>渝ICP备2024018631号</a>
</span>|
<span>&copy; 2025 <a href=https://sirius1y.top/>Sirius' Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>